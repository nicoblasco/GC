@model IEnumerable<GuardiaComunal.Models.Rol>

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div id="page-wrapper">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">Roles</h1>
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <!-- /.row -->
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <button type="button" id="btnNuevo" class="btn btn-primary" data-toggle="modal" data-target="#nuevoModal">
                        Nuevo
                    </button>
                    <button type="button" id="btnEditar" class="btn btn-primary" data-toggle="modal" data-target="#editarModal">
                        Editar
                    </button>
                    <button type="button" id="btnBorrar" class="btn btn-primary" data-toggle="modal" data-target="#borrarModal">
                        Borrar
                    </button>
                </div>
                <!-- /.panel-heading -->


                <div class="panel-body">

                    <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Perfil</th>
                                <th>Descripción</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr class="odd gradeX">
                                    <td>@item.Id</td>
                                    <td class="center">@item.Nombre</td>
                                    <td class="center">@item.Descripcion</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    <!-- /.table-responsive -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <!-- /#row -->
</div>
<!-- /#page-wrapper -->



<!-- Modal -->

<div class="modal fade" id="nuevoModal" role="dialog">
    <div class="modal-dialog">
        <form id="form-create" method="post">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Nuevo Rol</h4>
                </div>
                <div class="modal-body">
                    <form role="form">
                        <div class="form-group">
                            <label>Perfil</label>
                            <input id="input-Perfil" name="inputPerfil" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Descripción</label>
                            <input id="input-Descripcion" name="inputDescripcion" class="form-control">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </div>
            </div>
        </form>
</div>
</div>


@section scripts {
<script>
    $(document).ready(function() {
        $('#dataTables-example').DataTable({
            responsive: true
        });

        var table = $('#dataTables-example').DataTable();

        $('#dataTables-example tbody').on( 'click', 'tr', function () {
            if ( $(this).hasClass('selected') ) {
                $(this).removeClass('selected');
            }
            else {
                table.$('tr.selected').removeClass('selected');
                $(this).addClass('selected');
            }
        } );

        $('#btnBorrar').click( function () {
            table.row('.selected').remove().draw( false );
        });




    });

        $("#form-create").validate({
        rules: {
            inputPerfil: { required: true, minlength: 2, maxlength: 64 },
            inputDescripcion: { required: true, minlength: 2, maxlength: 64 }
        },
        messages: {
            inputPerfil: {
                required: "Este campo es requerido.",
                minlength: "Introduzca al menos 2 caracteres.",
                maxlength: "La longitud máxima permtida es de 64 caracteres."
            },
            inputDescripcion: {
                required: "Este campo es requerido.",
                minlength: "Introduzca al menos 2 caracteres.",
                maxlength: "La longitud máxima permtida es de 64 caracteres."
            }
        },
            submitHandler: function (form) {
                // Creamos un div que bloqueara todo el formulario
                var block = $('<div class="block-loading" />');
                form.prepend(block);
                var rol = new Object();
                rol.Nombre = $("#input-Perfil").val();
                rol.Descripcion = $("#input-Descripcion").val();
                var data = JSON.stringify(rol);

                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("CreateRol")',
                    data: data,
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (dataResponse) {
                        block.remove();
                        if (dataResponse.responseCode === '0') {
                            alert('OK');

                        } else {
                            alert('Fallo');
                        }
                    },
                    error: function (response) {
                        block.remove();
                        alert('Fallo');
                    }
                });
            },
            errorElement: "p"
    });

</script>
}